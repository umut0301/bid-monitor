# ä½¿ç”¨æŒ‡å— (User Guide)

æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•éƒ¨ç½²ã€é…ç½®å’Œä½¿ç”¨æ‹›æŠ•æ ‡ç›‘æ§é¢„è­¦ç³»ç»Ÿã€‚

---

## ç³»ç»Ÿè¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

| ç»„ä»¶ | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ |
| :--- | :--- | :--- |
| **æ“ä½œç³»ç»Ÿ** | Linux / macOS / Windows | Ubuntu 22.04 LTS |
| **Python** | 3.11 | 3.11+ |
| **PostgreSQL** | 12 | 15+ |
| **å†…å­˜** | 2GB | 4GB+ |
| **ç£ç›˜ç©ºé—´** | 5GB | 10GB+ |

---

## å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/YOUR_USERNAME/bid-monitor.git
cd bid-monitor
```

### æ­¥éª¤2: å®‰è£…ä¾èµ–

#### 2.1 å®‰è£…Pythonä¾èµ–

```bash
pip install -r requirements.txt
```

#### 2.2 å®‰è£…Playwrightæµè§ˆå™¨é©±åŠ¨

```bash
playwright install chromium
```

### æ­¥éª¤3: é…ç½®æ•°æ®åº“

#### 3.1 å®‰è£…PostgreSQL

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
```

**macOS:**
```bash
brew install postgresql
brew services start postgresql
```

#### 3.2 åˆ›å»ºæ•°æ®åº“

```bash
sudo -u postgres psql
```

åœ¨PostgreSQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š

```sql
CREATE DATABASE bid_monitor;
CREATE USER bid_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE bid_monitor TO bid_user;
\q
```

### æ­¥éª¤4: é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` æ–‡ä»¶å¹¶é‡å‘½åä¸º `.env`ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å†™ä»¥ä¸‹é…ç½®ï¼š

```env
# æ•°æ®åº“è¿æ¥URL
DATABASE_URL=postgresql://bid_user:your_password@localhost:5432/bid_monitor

# ä¼ä¸šå¾®ä¿¡æœºå™¨äººWebhook URL (å¯é€‰)
WECOM_WEBHOOK_URL=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY

# é’‰é’‰æœºå™¨äººWebhook URL (å¯é€‰)
DINGTALK_WEBHOOK_URL=https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN
```

### æ­¥éª¤5: åˆå§‹åŒ–æ•°æ®åº“

```bash
python app/core/database.py
```

æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```
2026-01-31 18:00:00.000 | INFO | å¼€å§‹åˆå§‹åŒ–æ•°æ®åº“...
2026-01-31 18:00:01.000 | INFO | æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
2026-01-31 18:00:01.500 | INFO | å…¨æ–‡æ£€ç´¢ç´¢å¼•åˆ›å»ºæˆåŠŸ
2026-01-31 18:00:02.000 | INFO | å…³é”®è¯æ•°æ®åˆå§‹åŒ–æˆåŠŸ
2026-01-31 18:00:02.000 | INFO | æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
```

### æ­¥éª¤6: å¯åŠ¨ç³»ç»Ÿ

#### 6.1 å¯åŠ¨çˆ¬è™«è°ƒåº¦å™¨

åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
python crawler/scheduler.py
```

ç³»ç»Ÿå°†ç«‹å³æ‰§è¡Œé¦–æ¬¡çˆ¬å–ä»»åŠ¡ï¼Œç„¶åæ¯å°æ—¶è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ã€‚

#### 6.2 å¯åŠ¨æ•°æ®çœ‹æ¿ï¼ˆå¯é€‰ï¼‰

åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
streamlit run dashboard/main_dashboard.py
```

è®¿é—® `http://localhost:8501` æŸ¥çœ‹æ•°æ®çœ‹æ¿ã€‚

---

## åŠŸèƒ½è¯´æ˜

### 1. è‡ªåŠ¨çˆ¬å–

ç³»ç»Ÿé»˜è®¤æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡çˆ¬å–ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥åœ¨ `crawler/scheduler.py` ä¸­ä¿®æ”¹æ‰§è¡Œé¢‘ç‡ï¼š

```python
# ä¿®æ”¹Cronè¡¨è¾¾å¼
self.scheduler.add_job(
    self.crawl_and_alert,
    trigger=CronTrigger(hour='*', minute='0'),  # æ¯å°æ—¶æ•´ç‚¹
    # æˆ–è€…æ”¹ä¸ºæ¯30åˆ†é’Ÿ: trigger=CronTrigger(minute='*/30')
    ...
)
```

### 2. å…³é”®è¯é…ç½®

ç³»ç»Ÿé»˜è®¤é…ç½®äº†ä»¥ä¸‹å…³é”®è¯ï¼š

| å…³é”®è¯ | æƒé‡ | åˆ†ç±» |
| :--- | :--- | :--- |
| å¹¿å‘Š | 1.5 | å¹¿å‘Šç±» |
| æ ‡è¯† | 1.2 | æ ‡è¯†ç±» |
| ç‰Œ | 1.0 | æ ‡è¯†ç±» |
| æ ‡å¿— | 1.2 | æ ‡è¯†ç±» |
| å®£ä¼  | 1.3 | å®£ä¼ ç±» |
| æ  | 1.0 | å®£ä¼ ç±» |
| æ–‡åŒ– | 1.1 | æ–‡åŒ–ç±» |

#### å¦‚ä½•ä¿®æ”¹å…³é”®è¯ï¼Ÿ

æ‚¨å¯ä»¥ç›´æ¥åœ¨æ•°æ®åº“ä¸­ä¿®æ”¹ `keywords` è¡¨ï¼š

```sql
-- æ·»åŠ æ–°å…³é”®è¯
INSERT INTO keywords (id, keyword, weight, category, is_active)
VALUES ('kw_å±•è§ˆ', 'å±•è§ˆ', 1.2, 'æ–‡åŒ–ç±»', 'true');

-- ä¿®æ”¹å…³é”®è¯æƒé‡
UPDATE keywords SET weight = 2.0 WHERE keyword = 'å¹¿å‘Š';

-- ç¦ç”¨æŸä¸ªå…³é”®è¯
UPDATE keywords SET is_active = 'false' WHERE keyword = 'æ–‡åŒ–';
```

### 3. é¢„è­¦é˜ˆå€¼

ç³»ç»Ÿé»˜è®¤çš„é¢„è­¦é˜ˆå€¼ä¸º **2.0**ï¼Œå³å½“é¡¹ç›®çš„åŒ¹é…åˆ†æ•° â‰¥ 2.0 æ—¶ï¼Œä¼šè§¦å‘é¢„è­¦æ¨é€ã€‚

æ‚¨å¯ä»¥åœ¨ `crawler/scheduler.py` ä¸­ä¿®æ”¹ï¼š

```python
class BidMonitorScheduler:
    def __init__(self, headless: bool = True):
        ...
        self.alert_threshold = 3.0  # ä¿®æ”¹ä¸º3.0
```

### 4. æ¶ˆæ¯æ¨é€

#### 4.1 ä¼ä¸šå¾®ä¿¡æœºå™¨äºº

1. åœ¨ä¼ä¸šå¾®ä¿¡ç¾¤ä¸­æ·»åŠ æœºå™¨äºº
2. è·å–Webhook URL
3. å°†URLé…ç½®åˆ° `.env` æ–‡ä»¶çš„ `WECOM_WEBHOOK_URL`

#### 4.2 é’‰é’‰æœºå™¨äºº

1. åœ¨é’‰é’‰ç¾¤ä¸­æ·»åŠ è‡ªå®šä¹‰æœºå™¨äºº
2. è·å–Webhook URL
3. å°†URLé…ç½®åˆ° `.env` æ–‡ä»¶çš„ `DINGTALK_WEBHOOK_URL`

**é¢„è­¦æ¶ˆæ¯ç¤ºä¾‹ï¼š**

```
ğŸ”” **æ‹›æ ‡æœºä¼šé¢„è­¦**

**é¡¹ç›®æ ‡é¢˜**: æŸå¸‚æ–‡åŒ–å¹¿åœºæ ‡è¯†æ ‡ç‰Œåˆ¶ä½œå®‰è£…é¡¹ç›®

**åŒ¹é…åˆ†æ•°**: 5.20
**åŒ¹é…å…³é”®è¯**: å¹¿å‘Š(2æ¬¡), æ ‡è¯†(3æ¬¡), å®£ä¼ (1æ¬¡), æ–‡åŒ–(2æ¬¡)

**ä¸šä¸»å•ä½**: æŸå¸‚æ–‡åŒ–å±€
**é¢„ç®—é‡‘é¢**: 500 ä¸‡å…ƒ
**æŠ¥åæˆªæ­¢**: 2026-02-15 17:00
**å¼€æ ‡æ—¶é—´**: 2026-02-20 09:00
**å®æ–½åœ°å€**: æŸå¸‚æ–‡åŒ–å¹¿åœº

**è¯¦æƒ…é“¾æ¥**: https://www.okcis.cn/xxx.html

---
*æ‹›æŠ•æ ‡ç›‘æ§ç³»ç»Ÿè‡ªåŠ¨æ¨é€*
```

### 5. æ•°æ®çœ‹æ¿

è®¿é—® `http://localhost:8501` å¯ä»¥æŸ¥çœ‹ï¼š

- **ç»Ÿè®¡é¢æ¿**: æ€»é¡¹ç›®æ•°ã€ä»Šæ—¥æ–°å¢ã€é«˜åˆ†é¡¹ç›®ã€æœ€è¿‘çˆ¬å–æ—¶é—´
- **é¡¹ç›®åˆ—è¡¨**: æ”¯æŒæŒ‰åŒ¹é…åˆ†æ•°å’Œæ•°é‡ç­›é€‰
- **é¡¹ç›®è¯¦æƒ…**: ç‚¹å‡»é¡¹ç›®æŸ¥çœ‹å®Œæ•´ä¿¡æ¯
- **çˆ¬å–æ—¥å¿—**: æŸ¥çœ‹æœ€è¿‘çš„ä»»åŠ¡æ‰§è¡Œè®°å½•

---

## å¸¸è§é—®é¢˜

### Q1: éªŒè¯ç è¯†åˆ«å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: éªŒè¯ç è¯†åˆ«å¤±è´¥å¯èƒ½ç”±ä»¥ä¸‹åŸå› å¯¼è‡´ï¼š

1. **OCRè¯†åˆ«é”™è¯¯**: PaddleOCRå¯èƒ½æ— æ³•æ­£ç¡®è¯†åˆ«éªŒè¯ç å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚
   - **è§£å†³æ–¹æ¡ˆ**: ç³»ç»Ÿä¼šè‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œå¦‚æœä»ç„¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥éªŒè¯ç å›¾ç‰‡ï¼ˆä¿å­˜åœ¨ `/tmp/bid_monitor_captcha/`ï¼‰ã€‚

2. **ç½‘ç»œé—®é¢˜**: éªŒè¯ç æäº¤åç½‘ç»œè¶…æ—¶ã€‚
   - **è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´ã€‚

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ

**A**: è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. PostgreSQLæœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥URLæ˜¯å¦æ­£ç¡®
3. æ•°æ®åº“ç”¨æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™

### Q3: å¦‚ä½•åœæ­¢ç³»ç»Ÿï¼Ÿ

**A**: åœ¨è¿è¡Œ `crawler/scheduler.py` çš„ç»ˆç«¯ä¸­æŒ‰ `Ctrl+C` å³å¯åœæ­¢ã€‚

### Q4: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ

**A**: ç³»ç»Ÿæ—¥å¿—ä¼šè¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†æ—¥å¿—é‡å®šå‘åˆ°æ–‡ä»¶ï¼š

```bash
python crawler/scheduler.py > logs/crawler.log 2>&1
```

### Q5: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

**A**: ä½¿ç”¨PostgreSQLçš„å¤‡ä»½å·¥å…·ï¼š

```bash
pg_dump -U bid_user bid_monitor > backup.sql
```

æ¢å¤æ•°æ®ï¼š

```bash
psql -U bid_user bid_monitor < backup.sql
```

---

## è¿›é˜¶é…ç½®

### 1. Dockeréƒ¨ç½²

æˆ‘ä»¬æä¾›äº†Docker Composeé…ç½®æ–‡ä»¶ï¼ˆå¾…æ·»åŠ ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Dockerå¿«é€Ÿéƒ¨ç½²ï¼š

```bash
docker-compose up -d
```

### 2. å®šæ—¶ä»»åŠ¡ï¼ˆCronï¼‰

å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ç³»ç»Ÿçš„Cronè€Œä¸æ˜¯APSchedulerï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š

```bash
crontab -e
```

æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š

```
0 * * * * cd /path/to/bid-monitor && python crawler/scheduler.py --once
```

ï¼ˆæ³¨æ„ï¼šéœ€è¦ä¿®æ”¹ `scheduler.py` æ·»åŠ  `--once` å‚æ•°æ”¯æŒï¼‰

### 3. å¤šæ•°æ®æºæ‰©å±•

å¦‚æœæ‚¨éœ€è¦ç›‘æ§å…¶ä»–æ‹›æ ‡ç½‘ç«™ï¼Œåªéœ€ï¼š

1. åœ¨ `crawler/parsers/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è§£æå™¨ï¼ˆç»§æ‰¿ `BaseParser`ï¼‰
2. åœ¨ `scheduler.py` ä¸­æ·»åŠ æ–°çš„çˆ¬å–ä»»åŠ¡

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜"éƒ¨åˆ†
2. æŸ¥çœ‹é¡¹ç›®çš„ [GitHub Issues](https://github.com/YOUR_USERNAME/bid-monitor/issues)
3. æäº¤æ–°çš„Issueæè¿°æ‚¨çš„é—®é¢˜

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼**
